<?xml version="1.0" encoding="utf-8" standalone="yes"?><?xml-stylesheet href="/pretty-feed-v3.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>security on Hugo van Kemenade</title><link>https://hugovk.dev/tags/security/</link><description>Recent content in security on Hugo van Kemenade</description><generator>Hugo</generator><language>en</language><copyright>&lt;a href="https://creativecommons.org/licenses/by-sa/4.0/"&gt;{{&lt; icon "cc" &gt;}}&amp;hairsp;{{&lt; icon "cc-by" &gt;}}&amp;hairsp;{{&lt; icon "cc-sa" &gt;}}&lt;/a&gt;&amp;nbsp;Hugo van Kemenade&lt;br&gt;&lt;p class="text-xs text-neutral-500 dark:text-neutral-400"&gt;Powered by &lt;a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://gohugo.io/" target="_blank" rel="noopener noreferrer"&gt;Hugo&lt;/a&gt; &amp;amp; &lt;a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer"&gt;Congo&lt;/a&gt; &amp;amp; &lt;a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://hugovk.dev" target="_blank" rel="noopener noreferrer"&gt;Hugo&lt;/a&gt;&lt;/p&gt;</copyright><lastBuildDate>Thu, 27 Nov 2025 12:55:00 +0000</lastBuildDate><atom:link href="https://hugovk.dev/tags/security/index.xml" rel="self" type="application/rss+xml"/><item><title>Setting secrets in env vars</title><link>https://hugovk.dev/blog/2025/secrets-in-env-vars/</link><pubDate>Thu, 27 Nov 2025 12:55:00 +0000</pubDate><guid>https://hugovk.dev/blog/2025/secrets-in-env-vars/</guid><description>&lt;p&gt;Sometimes you need to set environment variables with secrets, API keys or tokens, but
they can be susceptible to exfiltration by malware, as seen during the
&lt;a href="https://about.gitlab.com/blog/gitlab-discovers-widespread-npm-supply-chain-attack/"&gt;recent Shai-Hulud attack&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For publishing to PyPI, it&amp;rsquo;s
&lt;a href="https://blog.pypi.org/posts/2025-11-26-pypi-and-shai-hulud/"&gt;strongly recommended to use Trusted Publishing&lt;/a&gt;
rather than managing long-lived tokens on your machine.&lt;/p&gt;
&lt;p&gt;For other credentials, here&amp;rsquo;s how you can set them as env vars with 1Password CLI and
direnv on macOS.&lt;/p&gt;
&lt;h2 id="1password" class="relative group"&gt;1Password &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"&gt;&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1password" aria-label="Anchor"&gt;#&lt;/a&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;The 1Password password manager has a
&lt;a href="]%28https://1password.com/downloads/command-line%29"&gt;command-line interface called &lt;code&gt;op&lt;/code&gt;&lt;/a&gt;.
Thanks to Simon Willison for his useful
&lt;a href="https://til.simonwillison.net/macos/1password-terminal"&gt;TIL post&lt;/a&gt; about it.&lt;/p&gt;
&lt;p&gt;First &lt;a href="https://developer.1password.com/docs/cli/get-started/"&gt;install the CLI&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sh" data-lang="sh"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;brew install 1password-cli
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then open 1Password &amp;gt; Settings &amp;gt; Developer &amp;gt; Integrate with 1Password CLI.&lt;/p&gt;
&lt;p&gt;Then you can use the &lt;code&gt;op&lt;/code&gt; command with your password item&amp;rsquo;s name in 1Password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; op item get &lt;span class="s2"&gt;&amp;#34;My secret item&amp;#34;&lt;/span&gt; --fields password
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;[use &amp;#39;op item get xkm4wrtpvnq8hcjd3yfzs2belg --reveal&amp;#39; to reveal]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This obscures the actual password, and gives the item&amp;rsquo;s ID. You can use this ID:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; op item get xkm4wrtpvnq8hcjd3yfzs2belg --fields password
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;[use &amp;#39;op item get xkm4wrtpvnq8hcjd3yfzs2belg --reveal&amp;#39; to reveal]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Use &lt;code&gt;--reveal&lt;/code&gt; to see the actual password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; op item get &lt;span class="s2"&gt;&amp;#34;My secret item&amp;#34;&lt;/span&gt; --fields password --reveal
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;my-secret-password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; op item get xkm4wrtpvnq8hcjd3yfzs2belg --fields password --reveal
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;my-secret-password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Alternatively, use a
&lt;a href="https://developer.1password.com/docs/cli/secret-reference-syntax/"&gt;secret reference&lt;/a&gt;.
Open the item in 1Password, next to the password click âŒ„ and select Copy Secret
Reference then &lt;code&gt;op read &lt;/code&gt;it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; op &lt;span class="nb"&gt;read&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;op://MyVault/xkm4wrtpvnq8hcjd3yfzs2belg/password&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;my-secret-password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The secret reference is made up of the vault name and item ID, and &lt;code&gt;op read&lt;/code&gt; doesn&amp;rsquo;t
need &lt;code&gt;--reveal&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Take your pick which one you prefer.&lt;/p&gt;
&lt;h2 id="direnv" class="relative group"&gt;direnv &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"&gt;&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#direnv" aria-label="Anchor"&gt;#&lt;/a&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href="https://direnv.net/"&gt;direnv&lt;/a&gt; is a handy shell tool that can load and unload environment
variables depending on your current directory.&lt;/p&gt;
&lt;p&gt;Next, let&amp;rsquo;s set up direnv so that when you &lt;code&gt;cd&lt;/code&gt; into a certain directory, it fetches the
password from 1Password and sets it as an env var. When &lt;code&gt;cd&lt;/code&gt;ing out, the env var is
unloaded.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://direnv.net/docs/installation.html"&gt;Install&lt;/a&gt; direnv:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;brew install direnv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then &lt;a href="https://direnv.net/docs/hook.html"&gt;hook direnv into your shell&lt;/a&gt;. If you use
&lt;a href="https://ohmyz.sh/"&gt;Oh My Zsh&lt;/a&gt;, edit &lt;code&gt;~/.zshrc&lt;/code&gt; and add &lt;code&gt;direnv&lt;/code&gt; to the plugins list:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;plugins=(git gitfast gh you-should-use direnv)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Restart/reload your shell:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;source ~/.zshrc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(I first got &amp;ldquo;Warning: direnv not found. Please install direnv and ensure it&amp;rsquo;s in your
PATH before using this plugin&amp;rdquo; so needed to move
&lt;code&gt;eval &amp;quot;$(/opt/homebrew/bin/brew shellenv)&amp;quot;&lt;/code&gt; before &lt;code&gt;source $ZSH/oh-my-zsh.sh&lt;/code&gt;.)&lt;/p&gt;
&lt;p&gt;Now, in your project directory, create a file called &lt;code&gt;.envrc&lt;/code&gt; containing an env var
export that calls &lt;code&gt;op&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# .envrc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;DEBUG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;MY_SECRET&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;op &lt;span class="nb"&gt;read&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;op://MyVault/xkm4wrtpvnq8hcjd3yfzs2belg/password&amp;#34;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On first run, you need to explicitly allow &lt;code&gt;direnv&lt;/code&gt; to run for this directory. You also
need to do this when editing &lt;code&gt;.envrc&lt;/code&gt; later:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;direnv allow .
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If 1Password is set up with a passkey, it will now prompt to authorise:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; my-project
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: loading ~/my-project/.envrc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: export +DEBUG +MY_SECRET
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sometimes it shows a warning because of the 1Password UI prompt, but it&amp;rsquo;s okay:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; my-project
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: loading ~/my-project/.envrc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: ([/opt/homebrew/bin/direnv export zsh]) is taking a while to execute. Use CTRL-C to give up.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: export +DEBUG +MY_SECRET
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then you can access the env var in your scripts:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DEBUG&lt;/span&gt;&lt;span class="p"&gt;-nope&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MY_SECRET&lt;/span&gt;&lt;span class="p"&gt;-nope&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;my-secret-password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;But when leaving the directory, you can no longer access it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; ..
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;direnv: unloading
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DEBUG&lt;/span&gt;&lt;span class="p"&gt;-nope&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;nope
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MY_SECRET&lt;/span&gt;&lt;span class="p"&gt;-nope&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="go"&gt;nope
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="bonus" class="relative group"&gt;Bonus &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"&gt;&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#bonus" aria-label="Anchor"&gt;#&lt;/a&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;1Password offers
&lt;a href="https://github.com/1Password/for-open-source"&gt;Team accounts to open-source projects&lt;/a&gt; as
a way of giving back to the open source community.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;small&gt;Header photo:
&lt;a href="https://archive.org/details/bearings1218951896cycl/page/n1161/mode/2up"&gt;Slaymaker Barry Co. Sprocket Locks&lt;/a&gt;
in
&lt;a href="https://library.si.edu/digital-library/book/bearings"&gt;The Bearings (vol. XII no. 23, 2nd January 1896)&lt;/a&gt;
in the &lt;a href="https://library.si.edu/digital-library/"&gt;Smithsonian Libraries and Archives&lt;/a&gt;,
with &lt;a href="https://library.si.edu/copyright"&gt;no known copyright restrictions&lt;/a&gt;.&lt;/small&gt;&lt;/p&gt;</description></item></channel></rss>